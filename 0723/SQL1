--제약 중복되지 않는 값 UNIQUE
DROP TABLE TABLE_UNIQUE;
CREATE TABLE TABLE_UNIQUE(
    LOGIN_ID    VARCHAR(20) UNIQUE,
    LOGIN_PWD   VARCHAR2(20) NOT NULL,
    TEL         VARCHAR(20)
);
SELECT * FROM TABLE_UNIQUE;
DESC TABLE_UNIQUE;

--14-15
SELECT OWNER, CONSTRAINT_NAME, CONSTRAINT_TYPE, TABLE_NAME
FROM USER_CONSTRAINTS
WHERE TABLE_NAME = 'TABLE_UNIQUE';

--14-16
SELECT * FROM TABLE_UNIQUE;
INSERT INTO TABLE_UNIQUE (LOGIN_ID, LOGIN_PWD, TEL)
VALUES ('TEST_ID_02', 'PWD01', '010-1234-5678');

INSERT INTO TABLE_UNIQUE (LOGIN_ID, LOGIN_PWD, TEL)
VALUES ('TEST_ID_04', NULL, '010-1234-5678');

CREATE TABLE TABLE_UNIQUE2(
    LOGIN_ID    VARCHAR(20) CONSTRAINT TABLE2_LOGID_UNQ UNIQUE,
    LOGIN_PWD   VARCHAR2(20) CONSTRAINT TABLE2_LOGPW_NN NOT NULL,
    TEL         VARCHAR(20)
);

SELECT OWNER, CONSTRAINT_NAME,CONSTRAINT_TYPE, TABLE_NAME
FROM USER_CONSTRAINTS
WHERE TABLE_NAME LIKE 'TABLE_UNIQUE%';

--제약 조건 삭제하기
ALTER TABLE TABLE_UNIQUE2
DROP CONSTRAINT TBLUNQ2_LGNPW_NN;

--14-29
CREATE TABLE TABLE_PK(
    LOGIN_ID VARCHAR2(20) PRIMARY KEY,
    LOGIN_PWD VARCHAR2(20) NOT NULL,
    TEL VARCHAR(20)
);

SELECT OWNER, CONSTRAINT_NAME,CONSTRAINT_TYPE, TABLE_NAME
FROM USER_CONSTRAINTS
WHERE TABLE_NAME LIKE 'TABLE_PK%';

-- INDEX 확인
SELECT INDEX_NAME, TABLE_OWNER, TABLE_NAME
FROM USER_INDEXES
WHERE TABLE_NAME LIKE 'TABLE_PK%';

--14-32 제약의 이름을 넣자
CREATE TABLE TABLE_PK2(
    LOGIN_ID VARCHAR2(20) CONSTRAINT TBLPK2_LGNID_PK PRIMARY KEY,
    LOGIN_PWD VARCHAR2(20) CONSTRAINT TBLPK2_LGNPW_NN NOT NULL,
    TEL VARCHAR(20)
);
DESC TABLE_PK2;

--삽입
INSERT INTO TABLE_PK
VALUES ('TEST_ID_01', 'PWD01', '010-1234-5678');

SELECT * FROM TABLE_PK;

--테이블 간의 관계 연관(R) 만들기
--14-29
CREATE TABLE DEPT_FK(
    DEPTNO  NUMBER(2) CONSTRAINT DEPTFK_DEPTNO_PK PRIMARY KEY,
    DNAME   VARCHAR2(14),
    LOC     VARCHAR(13)
);
CREATE TABLE EMP_FK(
    EMPNO  NUMBER(4) CONSTRAINT EMPFK_EMPNO_PK PRIMARY KEY,
    DNAME   VARCHAR2(110),
    LOC     NUMBER(2) CONSTRAINT EMPFK_DEPTNO_FK REFERENCES DEPT_FK(DEPTNO)
);

--테이블 간의 관계 연관(R) 만들기
--14-29
DROP TABLE DEPT_FK;
CREATE TABLE DEPT_FK(
    DEPTNO  NUMBER(2) CONSTRAINT DEPTFK_DEPTNO_PK PRIMARY KEY,
    DNAME   VARCHAR2(14),
    LOC     VARCHAR(13)
);

SELECT * FROM DEPT_FK;
INSERT INTO DEPT_FK
VALUES (10, '개발1팀', '안동');

DELETE FROM DEPT_FK WHERE DEPTNO = 10;

DROP TABLE EMP_FK;
CREATE TABLE EMP_FK(
    EMPNO  NUMBER(4) CONSTRAINT EMPFK_EMPNO_PK PRIMARY KEY,
    DNAME   VARCHAR2(10),
    DEPTNO     NUMBER(2) REFERENCES DEPT_FK(DEPTNO) ON DELETE CASCADE
);
SELECT * FROM EMP_FK;
INSERT INTO EMP_FK
VALUES ( 1, '홍길동', 10);

DELETE FROM EMP_FK WHERE DEPTNO = 10;

--14-45 테이블 생성시 CHECK 제약 조건 설정하기
CREATE TABLE TABLE_CHECK(
    LOGIN_ID    VARCHAR2(20) PRIMARY KEY,
    LOGIN_PWD   VARCHAR2(20) CHECK (LENGTH(LOGIN_PWD)>3),
    TEL         VARCHAR2(20)
);

INSERT INTO TABLE_CHECK
VALUES ('TEST_ID', '1234', '010-1234-5678');
